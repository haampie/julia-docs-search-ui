<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css"> -->
    <title>Julia docs</title>

    <style>
      body {
        padding-top: 2rem;
        padding-bottom: 2rem;
      }
      .breadcrumb-stuff {
        list-style: none;
        display: flex;
        padding: 0;
        margin: 0;
        font-size: 0.6rem;
      }

      #hits {
        margin-top: 1em;
      }

      #hits a, #hits a:hover {
        display: block;
        color: inherit;
        text-decoration: none;
      }

      #hits mark {
        padding-right: 0.02em;
        padding-left: 0.02em;
      }

      .set-min-height {
        min-height: 7em;
      }
      .ais-hits--item {
        cursor: pointer;
      }
    </style>

  </head>
  <body>
    <div class="container">
      <h1>Julia docs</h1>

      <div class="row align-items-center set-min-height">
        <div class="col-8">
          <div class="input-group input-group-lg">
            <input type="text" class="form-control" id="searchbox">
          </div>
        </div>
        <div class="col">
          <div id="refinement-list"></div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div id="navigation"></div>
          <div id="hits" class="list-group"></div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>

    <script>
      function render_item(object) {
        let pre = 'https://docs.julialang.org/en/stable/';

        let stuff = '';

        if (object.type == 'Definition') {
          stuff += '<p class="h5"><code>' + object.full + '</code> <small class="text-muted">— ' + object.category + '</small></p>';
        }

        let is_section = false;

        for (let key of ['header7','header6','header5','header4','header3','header2','header1'])
        {
          if(object[key] !== undefined) {
            stuff += '<p class="h5">' + object[key] + ' <small class="text-muted">— Section</small></p>'
            is_section = true;
            break;
          }
        }

        if( !is_section) {
          stuff += '<p class="small">';
          stuff += object._snippetResult['content'].value;
          stuff += '</p>';
        }

        let count = 0;
        let breadcrumb = '';

        for (let key of ['lvl7','lvl6','lvl5','lvl4','lvl3','lvl2','lvl1'])
        {
          if (count == 2 && key != 'lvl1')
          {
            breadcrumb = '<li class="breadcrumb-item">' + object._highlightResult['lvl1'].value + '</li><li class="breadcrumb-item">...</li>' + breadcrumb;
            break
          }
          if (object[key] !== undefined && object[key].length > 0)
          {
            count++;
            breadcrumb = '<li class="breadcrumb-item">' + object._highlightResult[key].value + '</li>' + breadcrumb;
          }
        }

        breadcrumb = '<ol class="breadcrumb-stuff text-muted">' + breadcrumb + '</ol>';


        return '<a href="' + pre + object.url + '">' + stuff + breadcrumb + '</a>';
      }

      const search = instantsearch({
        appId: 'DX02JHO02H',
        apiKey: 'd2288cd341e4bd136965d634834e679e',
        indexName: 'testing',
        urlSync: true
      });

      search.addWidget(
        instantsearch.widgets.searchBox({
          container: document.getElementById('searchbox'),
          placeholder: '',
          magnifier: false,
          loadingIndicator: false,
          reset: false,
          wrapInput: false
        })
      );

      search.addWidget(
        instantsearch.widgets.refinementList({
          container: document.getElementById('refinement-list'),
          attributeName: 'type',
          autoHideContainer: false
        })
      );

      search.addWidget(
        instantsearch.widgets.pagination({ 
          container: document.getElementById('navigation'),
          cssClasses: {
            item: 'page-item',
            root: 'pagination',
            link: 'page-link',
            active: 'active',
            disabled: 'disabled',
            padding: 0
          }
        })
      );

      search.addWidget(
        instantsearch.widgets.hits({
          container: document.getElementById('hits'),
          cssClasses: {
            "item": 'list-group-item'
          },
          templates: {
            empty: 'No results',
            item: render_item
          }
        })
      );

      search.start();
    </script>

  </body>
</html>